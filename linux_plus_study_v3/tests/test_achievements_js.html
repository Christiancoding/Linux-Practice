<!DOCTYPE html>
<html>
<head>
    <title>Test Achievements JavaScript</title>
</head>
<body>
    <h2>Test Achievements Loading</h2>
    <div id="recent-achievements">Loading achievements...</div>
    
    <script>
    // Load and display achievements data
    function loadAchievementsData() {
        console.log('Loading achievements data...');
        fetch('http://127.0.0.1:5003/api/achievements')
            .then(response => response.json())
            .then(data => {
                console.log('Achievements data received:', data);
                updateAchievementsDisplay(data);
            })
            .catch(error => {
                console.error('Error loading achievements:', error);
                showAchievementsError();
            });
    }

    // Update achievements display
    function updateAchievementsDisplay(achievementsData) {
        const container = document.getElementById('recent-achievements');
        
        if (!achievementsData || !achievementsData.unlocked) {
            showAchievementsError();
            return;
        }
        
        const unlockedAchievements = achievementsData.unlocked || [];
        const availableAchievements = achievementsData.available || [];
        
        if (unlockedAchievements.length === 0) {
            // Show empty state when no achievements are unlocked
            container.innerHTML = `
                <div class="empty-achievements">
                    <div class="empty-icon">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <p>No achievements unlocked yet</p>
                    <small>Complete quizzes to earn your first achievement!</small>
                </div>
            `;
            return;
        }
        
        // Show unlocked achievements (recent ones first, max 3)
        const recentAchievements = unlockedAchievements.slice(-3).reverse();
        const remainingSlots = 3 - recentAchievements.length;
        
        let achievementsHTML = '';
        
        // Add unlocked achievements
        recentAchievements.forEach(achievement => {
            const badgeName = achievement.badge.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
            achievementsHTML += `
                <div class="achievement-item">
                    <div class="achievement-icon" style="background: var(--gradient-success);">
                        <i class="fas fa-star"></i>
                    </div>
                    <div class="achievement-info">
                        <h4>${badgeName}</h4>
                        <p>${achievement.description}</p>
                    </div>
                </div>
            `;
        });
        
        // Fill remaining slots with locked achievements
        const availableToShow = availableAchievements.slice(0, remainingSlots);
        availableToShow.forEach(achievement => {
            const badgeName = achievement.badge.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
            achievementsHTML += `
                <div class="achievement-item locked">
                    <div class="achievement-icon">
                        <i class="fas fa-lock"></i>
                    </div>
                    <div class="achievement-info">
                        <h4>${badgeName}</h4>
                        <p>${achievement.description}</p>
                    </div>
                </div>
            `;
        });
        
        container.innerHTML = achievementsHTML;
    }

    // Show error state for achievements
    function showAchievementsError() {
        const container = document.getElementById('recent-achievements');
        container.innerHTML = `
            <div class="empty-achievements">
                <div class="empty-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <p>Unable to load achievements</p>
                <small>Please try refreshing the page</small>
            </div>
        `;
    }
    
    // Auto-load when page loads
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Page loaded, calling loadAchievementsData...');
        loadAchievementsData();
    });
    </script>
    
    <style>
    .empty-achievements {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 2rem 1rem;
        text-align: center;
        color: #666;
        border: 1px solid #ddd;
        border-radius: 8px;
        margin: 1rem 0;
    }

    .empty-achievements .empty-icon {
        font-size: 2rem;
        margin-bottom: 1rem;
        opacity: 0.6;
    }

    .empty-achievements p {
        margin: 0 0 0.5rem 0;
        font-weight: 500;
    }

    .empty-achievements small {
        opacity: 0.8;
        font-size: 0.85rem;
    }
    </style>
</body>
</html>
