{% extends "base.html" %}

{% block title %}Settings - Linux+ Study Game{% endblock %}

{% block content %}
<!-- Settings Page -->
<div class="page-content active" id="page-settings">
    <!-- Page Header -->
    <div class="page-header" data-aos="fade-down">
        <h1 class="page-title">
            <i class="fas fa-cog text-gradient"></i>
            Settings & Preferences
        </h1>
        <p class="page-subtitle">Customize your learning experience</p>
    </div>

    <!-- Settings Navigation -->
    <div class="settings-nav glass mb-4" data-aos="fade-up">
        <button class="settings-tab active" onclick="switchSettingsTab('appearance')">
            <i class="fas fa-palette"></i> Appearance
        </button>
        <button class="settings-tab" onclick="switchSettingsTab('gameplay')">
            <i class="fas fa-gamepad"></i> Gameplay
        </button>
        <button class="settings-tab" onclick="switchSettingsTab('notifications')">
            <i class="fas fa-bell"></i> Notifications
        </button>
        <button class="settings-tab" onclick="switchSettingsTab('privacy')">
            <i class="fas fa-shield-alt"></i> Privacy
        </button>
        <button class="settings-tab" onclick="switchSettingsTab('data')">
            <i class="fas fa-database"></i> Data
        </button>
    </div>

    <!-- Settings Content -->
    <div class="settings-content">
        <!-- Appearance Settings -->
        <div class="settings-panel active" id="appearance-panel">
            <section class="settings-section glass" data-aos="fade-up">
                <h2 class="section-header">
                    <i class="fas fa-moon"></i> Theme Settings
                </h2>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>App Theme</h4>
                        <p>Choose your preferred color scheme</p>
                    </div>
                    <div class="setting-control">
                        <div class="theme-selector">
                            <button class="theme-option active" onclick="setTheme('dark')">
                                <i class="fas fa-moon"></i> Dark
                            </button>
                            <button class="theme-option" onclick="setTheme('light')">
                                <i class="fas fa-sun"></i> Light
                            </button>
                            <button class="theme-option" onclick="setTheme('cosmic')">
                                <i class="fas fa-star"></i> Cosmic
                            </button>
                        </div>
                    </div>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Accent Color</h4>
                        <p>Customize interface accent colors</p>
                    </div>
                    <div class="setting-control">
                        <div class="color-picker-group">
                            <button class="color-option active" style="background: #7c3aed;" onclick="setAccentColor('#7c3aed')"></button>
                            <button class="color-option" style="background: #ec4899;" onclick="setAccentColor('#ec4899')"></button>
                            <button class="color-option" style="background: #06b6d4;" onclick="setAccentColor('#06b6d4')"></button>
                            <button class="color-option" style="background: #10b981;" onclick="setAccentColor('#10b981')"></button>
                            <button class="color-option" style="background: #f59e0b;" onclick="setAccentColor('#f59e0b')"></button>
                            <button class="color-option" style="background: #ef4444;" onclick="setAccentColor('#ef4444')"></button>
                        </div>
                    </div>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Font Size</h4>
                        <p>Adjust text size for better readability</p>
                    </div>
                    <div class="setting-control">
                        <div class="slider-control">
                            <input type="range" class="slider" id="font-size" min="80" max="120" value="100">
                            <span class="slider-value">100%</span>
                        </div>
                    </div>
                </div>
            </section>

            <section class="settings-section glass" data-aos="fade-up" data-aos-delay="100">
                <h2 class="section-header">
                    <i class="fas fa-desktop"></i> Display Settings
                </h2>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Animations</h4>
                        <p>Enable smooth animations and transitions</p>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="animations-toggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Reduce Motion</h4>
                        <p>Minimize animations for accessibility</p>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="reduce-motion">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>High Contrast</h4>
                        <p>Increase contrast for better visibility</p>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="high-contrast">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </section>
        </div>

        <!-- Gameplay Settings -->
        <div class="settings-panel" id="gameplay-panel">
            <section class="settings-section glass" data-aos="fade-up">
                <h2 class="section-header">
                    <i class="fas fa-brain"></i> Quiz Settings
                </h2>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Default Question Count</h4>
                        <p>Number of questions per quiz session</p>
                    </div>
                    <div class="setting-control">
                        <select class="form-select" id="question-count">
                            <option value="10">10 Questions</option>
                            <option value="20" selected>20 Questions</option>
                            <option value="30">30 Questions</option>
                            <option value="50">50 Questions</option>
                        </select>
                    </div>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Time per Question</h4>
                        <p>Default time limit for timed mode</p>
                    </div>
                    <div class="setting-control">
                        <select class="form-select" id="time-limit">
                            <option value="15">15 seconds</option>
                            <option value="30" selected>30 seconds</option>
                            <option value="45">45 seconds</option>
                            <option value="60">60 seconds</option>
                        </select>
                    </div>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Show Hints</h4>
                        <p>Display helpful hints during quizzes</p>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="show-hints" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Instant Feedback</h4>
                        <p>Show correct answer immediately</p>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="instant-feedback" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </section>

            <section class="settings-section glass" data-aos="fade-up" data-aos-delay="100">
                <h2 class="section-header">
                    <i class="fas fa-volume-up"></i> Sound Settings
                </h2>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Sound Effects</h4>
                        <p>Enable game sound effects</p>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="sound-effects" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Volume</h4>
                        <p>Adjust sound effect volume</p>
                    </div>
                    <div class="setting-control">
                        <div class="slider-control">
                            <input type="range" class="slider" id="volume" min="0" max="100" value="70">
                            <span class="slider-value">70%</span>
                        </div>
                    </div>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Success Sounds</h4>
                        <p>Play sound on correct answers</p>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="success-sounds" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </section>
        </div>

        <!-- Notifications Settings -->
        <div class="settings-panel" id="notifications-panel">
            <section class="settings-section glass" data-aos="fade-up">
                <h2 class="section-header">
                    <i class="fas fa-bell"></i> Notification Preferences
                </h2>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Study Reminders</h4>
                        <p>Daily reminders to practice</p>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="study-reminders">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Achievement Alerts</h4>
                        <p>Notify when unlocking achievements</p>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="achievement-alerts" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Streak Reminders</h4>
                        <p>Remind to maintain your streak</p>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="streak-reminders">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Reminder Time</h4>
                        <p>When to send daily reminders</p>
                    </div>
                    <div class="setting-control">
                        <input type="time" class="time-input" id="reminder-time" value="18:00">
                    </div>
                </div>
            </section>
        </div>

        <!-- Privacy Settings -->
        <div class="settings-panel" id="privacy-panel">
            <section class="settings-section glass" data-aos="fade-up">
                <h2 class="section-header">
                    <i class="fas fa-lock"></i> Privacy & Security
                </h2>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Anonymous Statistics</h4>
                        <p>Share anonymous usage data to improve the app</p>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="anonymous-stats">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Public Profile</h4>
                        <p>Show your stats on the leaderboard</p>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="public-profile" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Achievement Sharing</h4>
                        <p>Allow others to see your achievements</p>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="achievement-sharing" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </section>
        </div>

        <!-- Data Management -->
        <div class="settings-panel" id="data-panel">
            <section class="settings-section glass" data-aos="fade-up">
                <h2 class="section-header">
                    <i class="fas fa-download"></i> Data Management
                </h2>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Export Data</h4>
                        <p>Download all your progress data</p>
                    </div>
                    <div class="setting-control">
                        <button class="btn btn-primary" onclick="exportUserData()">
                            <i class="fas fa-download"></i> Export
                        </button>
                    </div>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Import Data</h4>
                        <p>Restore from a previous backup</p>
                    </div>
                    <div class="setting-control">
                        <button class="btn btn-secondary" onclick="importUserData()">
                            <i class="fas fa-upload"></i> Import
                        </button>
                    </div>
                </div>
                <div class="setting-item">
                    <div class="setting-info">
                        <h4>Auto Backup</h4>
                        <p>Automatically backup progress weekly</p>
                    </div>
                    <div class="setting-control">
                        <label class="toggle-switch">
                            <input type="checkbox" id="auto-backup" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </section>

            <section class="settings-section glass danger-zone" data-aos="fade-up" data-aos-delay="100">
                <h2 class="section-header text-danger">
                    <i class="fas fa-exclamation-triangle"></i> Danger Zone
                </h2>
                <div class="setting-item danger">
                    <div class="setting-info">
                        <h4>Reset Progress</h4>
                        <p>Clear all quiz history and stats</p>
                    </div>
                    <div class="setting-control">
                        <button class="btn btn-outline-danger" onclick="confirmResetProgress()">
                            Reset Progress
                        </button>
                    </div>
                </div>
                <div class="setting-item danger">
                    <div class="setting-info">
                        <h4>Clear Cache</h4>
                        <p>Remove temporary files and cached data</p>
                    </div>
                    <div class="setting-control">
                        <button class="btn btn-outline-danger" onclick="clearCache()">
                            Clear Cache
                        </button>
                    </div>
                </div>
                <div class="setting-item danger">
                    <div class="setting-info">
                        <h4>Delete Account</h4>
                        <p>Permanently delete all your data</p>
                    </div>
                    <div class="setting-control">
                        <button class="btn btn-danger" onclick="confirmDeleteAccount()">
                            Delete Account
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Save Settings Footer -->
    <div class="settings-footer glass" data-aos="fade-up">
        <button class="btn btn-secondary" onclick="resetSettings()">
            <i class="fas fa-undo"></i> Reset to Defaults
        </button>
        <button class="btn btn-primary" onclick="saveSettings()">
            <i class="fas fa-save"></i> Save Changes
        </button>
    </div>
</div>

<style>
/* Settings Page Specific Styles */
.settings-nav {
    display: flex;
    gap: 0.5rem;
    padding: 1rem;
    overflow-x: auto;
    scrollbar-width: thin;
}

.settings-tab {
    padding: 0.75rem 1.5rem;
    background: var(--bg-tertiary);
    border: 2px solid transparent;
    border-radius: var(--radius-full);
    color: var(--text-secondary);
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition-base);
    white-space: nowrap;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.settings-tab:hover {
    background: var(--bg-secondary);
    color: var(--text-primary);
}

.settings-tab.active {
    background: var(--gradient-primary);
    color: white;
    border-color: transparent;
}

.settings-panel {
    display: none;
}

.settings-panel.active {
    display: block;
}

.settings-section {
    padding: 2rem;
    margin-bottom: 2rem;
}

.section-header {
    font-size: 1.25rem;
    margin-bottom: 2rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.setting-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem 0;
    border-bottom: 1px solid var(--border-color);
}

.setting-item:last-child {
    border-bottom: none;
}

.setting-item.danger .setting-info h4 {
    color: var(--danger-color);
}

.setting-info {
    flex: 1;
    max-width: 500px;
}

.setting-info h4 {
    font-size: 1.125rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
    color: var(--text-primary);
}

.setting-info p {
    font-size: 0.875rem;
    color: var(--text-secondary);
    margin: 0;
}

.setting-control {
    display: flex;
    align-items: center;
    gap: 1rem;
}

/* Theme Selector */
.theme-selector {
    display: flex;
    gap: 0.5rem;
    background: var(--bg-tertiary);
    padding: 0.25rem;
    border-radius: var(--radius-full);
}

.theme-option {
    padding: 0.75rem 1.25rem;
    background: transparent;
    border: none;
    border-radius: var(--radius-full);
    cursor: pointer;
    transition: var(--transition-base);
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--text-secondary);
}

.theme-option.active,
.theme-option:hover {
    background: var(--gradient-primary);
    color: white;
    box-shadow: var(--shadow-md);
}

/* Color Picker */
.color-picker-group {
    display: flex;
    gap: 0.5rem;
}

.color-option {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 3px solid transparent;
    cursor: pointer;
    transition: var(--transition-base);
}

.color-option:hover {
    transform: scale(1.1);
}

.color-option.active {
    border-color: white;
    box-shadow: var(--shadow-lg);
}

/* Toggle Switch */
.toggle-switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 30px;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--bg-tertiary);
    transition: var(--transition-base);
    border-radius: var(--radius-full);
}

.toggle-slider::before {
    position: absolute;
    content: '';
    height: 24px;
    width: 24px;
    left: 3px;
    bottom: 3px;
    background: white;
    transition: var(--transition-base);
    border-radius: 50%;
}

.toggle-switch input:checked + .toggle-slider {
    background: var(--gradient-primary);
}

.toggle-switch input:checked + .toggle-slider::before {
    transform: translateX(30px);
}

/* Slider Control */
.slider-control {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.slider {
    width: 150px;
    height: 6px;
    background: var(--bg-tertiary);
    border-radius: var(--radius-full);
    outline: none;
    -webkit-appearance: none;
}

.slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    background: var(--gradient-primary);
    cursor: pointer;
    border-radius: 50%;
}

.slider::-moz-range-thumb {
    width: 20px;
    height: 20px;
    background: var(--gradient-primary);
    cursor: pointer;
    border-radius: 50%;
}

.slider-value {
    min-width: 50px;
    text-align: right;
    font-weight: 600;
    color: var(--text-primary);
}

/* Form Controls */
.form-select, .time-input {
    padding: 0.75rem 1rem;
    background: var(--bg-tertiary);
    border: 2px solid var(--border-color);
    border-radius: var(--radius-md);
    color: var(--text-primary);
    cursor: pointer;
    transition: var(--transition-base);
}

.form-select:focus, .time-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 4px rgba(124, 58, 237, 0.1);
}

/* Danger Zone */
.danger-zone {
    border: 2px solid rgba(239, 68, 68, 0.3);
    background: rgba(239, 68, 68, 0.05);
}

/* Settings Footer */
.settings-footer {
    position: sticky;
    bottom: 0;
    padding: 1.5rem;
    display: flex;
    justify-content: space-between;
    gap: 1rem;
    margin-top: 2rem;
    backdrop-filter: blur(20px);
    z-index: 10;
}

/* Responsive */
@media (max-width: 768px) {
    .settings-nav {
        flex-wrap: wrap;
    }
    
    .setting-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
    }
    
    .setting-control {
        width: 100%;
        justify-content: flex-end;
    }
    
    .settings-footer {
        flex-direction: column;
    }
    
    .settings-footer button {
        width: 100%;
    }
}
</style>
{% endblock %}

{% block scripts %}
<script>
// Settings page functionality
document.addEventListener('DOMContentLoaded', function() {
    loadSettings();
    initializeSliders();
});

// Load saved settings
function loadSettings() {
    const settings = JSON.parse(localStorage.getItem('appSettings') || '{}');
    
    // Apply saved settings
    if (settings.theme) {
        setTheme(settings.theme);
    }
    
    // Load other settings...
    document.getElementById('question-count').value = settings.questionCount || '20';
    document.getElementById('time-limit').value = settings.timeLimit || '30';
    document.getElementById('show-hints').checked = settings.showHints !== false;
    document.getElementById('instant-feedback').checked = settings.instantFeedback !== false;
    document.getElementById('sound-effects').checked = settings.soundEffects !== false;
    document.getElementById('volume').value = settings.volume || 70;
    
    // Update volume display
    updateSliderValue('volume');
}

// Switch settings tabs
function switchSettingsTab(tab) {
    // Update active tab
    document.querySelectorAll('.settings-tab').forEach(t => t.classList.remove('active'));
    event.target.classList.add('active');
    
    // Show corresponding panel
    document.querySelectorAll('.settings-panel').forEach(panel => {
        panel.classList.remove('active');
    });
    document.getElementById(`${tab}-panel`).classList.add('active');
}

// Initialize sliders
function initializeSliders() {
    const sliders = document.querySelectorAll('.slider');
    sliders.forEach(slider => {
        slider.addEventListener('input', function() {
            updateSliderValue(this.id);
        });
    });
}

// Update slider value display
function updateSliderValue(sliderId) {
    const slider = document.getElementById(sliderId);
    const value = slider.value;
    const valueDisplay = slider.nextElementSibling;
    
    if (valueDisplay && valueDisplay.classList.contains('slider-value')) {
        valueDisplay.textContent = value + '%';
    }
}

// Set accent color
function setAccentColor(color) {
    document.documentElement.style.setProperty('--primary-color', color);
    
    // Update active state
    document.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('active'));
    event.target.classList.add('active');
}

// Save settings
function saveSettings() {
    const settings = {
        theme: document.documentElement.getAttribute('data-theme'),
        questionCount: document.getElementById('question-count').value,
        timeLimit: document.getElementById('time-limit').value,
        showHints: document.getElementById('show-hints').checked,
        instantFeedback: document.getElementById('instant-feedback').checked,
        soundEffects: document.getElementById('sound-effects').checked,
        volume: document.getElementById('volume').value,
        animations: document.getElementById('animations-toggle').checked,
        studyReminders: document.getElementById('study-reminders').checked,
        achievementAlerts: document.getElementById('achievement-alerts').checked,
        // Add more settings...
    };
    
    localStorage.setItem('appSettings', JSON.stringify(settings));
    showMessage('success', 'Settings saved successfully!');
}

// Reset settings to defaults
function resetSettings() {
    if (confirm('Reset all settings to default values?')) {
        localStorage.removeItem('appSettings');
        location.reload();
    }
}

// Export user data
function exportUserData() {
    const userData = {
        settings: JSON.parse(localStorage.getItem('appSettings') || '{}'),
        stats: JSON.parse(localStorage.getItem('gameStats') || '{}'),
        history: JSON.parse(localStorage.getItem('quizHistory') || '[]'),
        achievements: JSON.parse(localStorage.getItem('achievements') || '[]')
    };
    
    const dataStr = JSON.stringify(userData, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});
    const url = URL.createObjectURL(dataBlob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = `linux-study-backup-${new Date().toISOString().split('T')[0]}.json`;
    a.click();
    
    showMessage('success', 'Data exported successfully!');
}

// Import user data
function importUserData() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    
    input.onchange = function(e) {
        const file = e.target.files[0];
        const reader = new FileReader();
        
        reader.onload = function(event) {
            try {
                const data = JSON.parse(event.target.result);
                
                // Validate data structure
                if (data.settings && data.stats) {
                    // Import data
                    localStorage.setItem('appSettings', JSON.stringify(data.settings));
                    localStorage.setItem('gameStats', JSON.stringify(data.stats));
                    localStorage.setItem('quizHistory', JSON.stringify(data.history || []));
                    localStorage.setItem('achievements', JSON.stringify(data.achievements || []));
                    
                    showMessage('success', 'Data imported successfully! Refreshing...');
                    setTimeout(() => location.reload(), 1500);
                } else {
                    showMessage('error', 'Invalid backup file format');
                }
            } catch (error) {
                showMessage('error', 'Failed to import data');
            }
        };
        
        reader.readAsText(file);
    };
    
    input.click();
}

// Confirm reset progress
function confirmResetProgress() {
    if (confirm('This will permanently delete all your quiz history and statistics. Are you sure?')) {
        if (confirm('This action cannot be undone. Please confirm again.')) {
            localStorage.removeItem('gameStats');
            localStorage.removeItem('quizHistory');
            showMessage('success', 'Progress reset successfully');
            setTimeout(() => location.reload(), 1500);
        }
    }
}

// Clear cache
function clearCache() {
    if (confirm('Clear all cached data?')) {
        // Clear specific cached items
        const keysToKeep = ['appSettings', 'gameStats', 'quizHistory', 'achievements'];
        const allKeys = Object.keys(localStorage);
        
        allKeys.forEach(key => {
            if (!keysToKeep.includes(key)) {
                localStorage.removeItem(key);
            }
        });
        
        showMessage('success', 'Cache cleared successfully');
    }
}

// Confirm delete account
function confirmDeleteAccount() {
    const confirmation = prompt('Type "DELETE" to permanently delete your account and all data:');
    
    if (confirmation === 'DELETE') {
        localStorage.clear();
        showMessage('success', 'Account deleted. Redirecting...');
        setTimeout(() => {
            window.location.href = '/';
        }, 2000);
    }
}

function showMessage(type, text) {
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${type} animate-fade-in`;
    messageDiv.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
        ${text}
    `;
    
    const container = document.querySelector('.container');
    container.insertBefore(messageDiv, container.firstChild);
    
    setTimeout(() => {
        messageDiv.remove();
    }, 3000);
}
</script>
{% endblock %}