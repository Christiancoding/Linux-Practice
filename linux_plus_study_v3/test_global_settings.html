<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Settings Test</title>
    <link rel="stylesheet" href="static/css/style.css">
    <script src="static/js/app.js"></script>
    <style>
        body { padding: 20px; }
        .test-section { 
            margin: 20px 0; 
            padding: 15px; 
            border: 1px solid var(--border-color, #ccc); 
            border-radius: 8px; 
            background: var(--bg-card, #f9f9f9);
        }
        button { 
            padding: 10px 20px; 
            margin: 5px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            background: var(--primary-color, #7c3aed); 
            color: white;
        }
    </style>
</head>
<body data-theme="dark">
    <h1>🔧 Global Settings Test</h1>
    <p>This page simulates navigation between pages to test global appearance settings persistence.</p>
    
    <div class="test-section">
        <h2>Current Settings</h2>
        <p>Theme: <span id="current-theme">Unknown</span></p>
        <p>Font Size: <span id="current-font-size">Unknown</span></p>
        <p>Accent Color: <span id="current-accent-color">Unknown</span></p>
        <p>Animations: <span id="current-animations">Unknown</span></p>
        <button onclick="showCurrentSettings()">📊 Show Current Settings</button>
    </div>
    
    <div class="test-section">
        <h2>Test Actions</h2>
        <button onclick="simulateSettingsChange()">🎨 Simulate Settings Change</button>
        <button onclick="simulatePageReload()">🔄 Simulate Page Navigation</button>
        <button onclick="clearAllSettings()">🗑️ Clear All Settings</button>
    </div>
    
    <div class="test-section">
        <h2>Sample Text</h2>
        <p>This is sample text that should change color and size based on the appearance settings.</p>
        <div style="padding: 10px; background: var(--primary-color); color: white; border-radius: 5px; display: inline-block;">
            🎯 Colored Element
        </div>
    </div>
    
    <div class="test-section">
        <h2>Test Results</h2>
        <pre id="test-results" style="background: #f0f0f0; padding: 10px; border-radius: 5px;"></pre>
    </div>

    <script>
        function showCurrentSettings() {
            const settings = JSON.parse(localStorage.getItem('appSettings') || '{}');
            const theme = document.documentElement.getAttribute('data-theme');
            const fontSize = document.documentElement.style.getPropertyValue('--base-font-size');
            const accentColor = document.documentElement.style.getPropertyValue('--primary-color');
            
            document.getElementById('current-theme').textContent = theme || 'Not set';
            document.getElementById('current-font-size').textContent = fontSize || 'Not set';
            document.getElementById('current-accent-color').textContent = accentColor || 'Not set';
            document.getElementById('current-animations').textContent = 
                document.body.classList.contains('no-animations') ? 'Disabled' : 'Enabled';
            
            document.getElementById('test-results').textContent = 
                'LocalStorage appSettings:\n' + JSON.stringify(settings, null, 2) +
                '\n\nApplied CSS Variables:\n' +
                '--base-font-size: ' + fontSize + '\n' +
                '--primary-color: ' + accentColor + '\n' +
                'data-theme: ' + theme;
        }
        
        function simulateSettingsChange() {
            console.log('Simulating settings change...');
            
            // Set test settings
            const testSettings = {
                theme: 'light',
                accentColor: '#ec4899',
                fontSize: 110,
                animations: true,
                reduceMotion: false
            };
            
            localStorage.setItem('appSettings', JSON.stringify(testSettings));
            
            // Apply immediately
            if (window.loadGlobalAppearanceSettings) {
                loadGlobalAppearanceSettings();
            } else {
                console.error('loadGlobalAppearanceSettings function not found!');
            }
            
            alert('Test settings applied! Check the visual changes and current settings.');
        }
        
        function simulatePageReload() {
            console.log('Simulating page reload...');
            location.reload();
        }
        
        function clearAllSettings() {
            localStorage.removeItem('appSettings');
            localStorage.removeItem('theme');
            alert('Settings cleared! Reload to see default appearance.');
        }
        
        // Test on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Test page loaded');
            setTimeout(() => {
                showCurrentSettings();
                
                // Test if loadGlobalAppearanceSettings is available
                if (window.loadGlobalAppearanceSettings) {
                    console.log('✅ loadGlobalAppearanceSettings function is available');
                } else {
                    console.error('❌ loadGlobalAppearanceSettings function not found');
                }
            }, 1000);
        });
    </script>
</body>
</html>